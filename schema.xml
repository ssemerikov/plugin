<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE schema SYSTEM "../../../lib/pkp/dtd/xmlSchema.dtd">

<!--
  * plugins/generic/reviewerCertificate/schema.xml
  *
  * Copyright (c) 2024
  * Distributed under the GNU GPL v3.
  *
  * Reviewer Certificate plugin database schema
  -->

<schema version="0.2.0">
    <!--
      * reviewer_certificate_templates: Stores certificate template configurations for each journal
      -->
    <table name="reviewer_certificate_templates">
        <field name="template_id" type="I8">
            <KEY />
            <AUTOINCREMENT />
        </field>
        <field name="context_id" type="I8">
            <NOTNULL />
        </field>
        <field name="template_name" type="C2" size="255">
            <NOTNULL />
        </field>
        <field name="background_image" type="C2" size="500"/>
        <field name="header_text" type="X"/>
        <field name="body_template" type="X"/>
        <field name="footer_text" type="X"/>
        <field name="font_family" type="C2" size="100">
            <DEFAULT VALUE="helvetica"/>
        </field>
        <field name="font_size" type="I4">
            <DEFAULT VALUE="12"/>
        </field>
        <field name="text_color_r" type="I4">
            <DEFAULT VALUE="0"/>
        </field>
        <field name="text_color_g" type="I4">
            <DEFAULT VALUE="0"/>
        </field>
        <field name="text_color_b" type="I4">
            <DEFAULT VALUE="0"/>
        </field>
        <field name="layout_settings" type="X"/>
        <field name="minimum_reviews" type="I4">
            <DEFAULT VALUE="1"/>
        </field>
        <field name="include_qr_code" type="I1">
            <DEFAULT VALUE="0"/>
        </field>
        <field name="enabled" type="I1">
            <DEFAULT VALUE="1"/>
        </field>
        <field name="date_created" type="T">
            <NOTNULL />
        </field>
        <field name="date_modified" type="T"/>
        <descr>Certificate templates for each journal</descr>
        <index name="reviewer_certificate_templates_context_id">
            <col>context_id</col>
        </index>
    </table>

    <!--
      * reviewer_certificates: Tracks all issued certificates
      -->
    <table name="reviewer_certificates">
        <field name="certificate_id" type="I8">
            <KEY />
            <AUTOINCREMENT />
        </field>
        <field name="reviewer_id" type="I8">
            <NOTNULL />
        </field>
        <field name="submission_id" type="I8">
            <NOTNULL />
        </field>
        <field name="review_id" type="I8">
            <NOTNULL />
        </field>
        <field name="context_id" type="I8">
            <NOTNULL />
        </field>
        <field name="template_id" type="I8"/>
        <field name="date_issued" type="T">
            <NOTNULL />
        </field>
        <field name="certificate_code" type="C2" size="100">
            <NOTNULL />
        </field>
        <field name="download_count" type="I4">
            <DEFAULT VALUE="0"/>
        </field>
        <field name="last_downloaded" type="T"/>
        <descr>Issued certificates tracking</descr>
        <index name="reviewer_certificates_reviewer_id">
            <col>reviewer_id</col>
        </index>
        <index name="reviewer_certificates_review_id">
            <col>review_id</col>
            <UNIQUE />
        </index>
        <index name="reviewer_certificates_certificate_code">
            <col>certificate_code</col>
            <UNIQUE />
        </index>
        <index name="reviewer_certificates_context_id">
            <col>context_id</col>
        </index>
    </table>

    <!--
      * reviewer_certificate_settings: Localized settings for certificate templates
      -->
    <table name="reviewer_certificate_settings">
        <field name="template_id" type="I8">
            <NOTNULL />
        </field>
        <field name="locale" type="C2" size="14">
            <NOTNULL />
            <DEFAULT VALUE=""/>
        </field>
        <field name="setting_name" type="C2" size="255">
            <NOTNULL />
        </field>
        <field name="setting_value" type="X"/>
        <field name="setting_type" type="C2" size="6">
            <NOTNULL />
        </field>
        <descr>Localized certificate template settings</descr>
        <index name="reviewer_certificate_settings_template_id">
            <col>template_id</col>
        </index>
        <index name="reviewer_certificate_settings_pkey">
            <col>template_id</col>
            <col>locale</col>
            <col>setting_name</col>
            <UNIQUE />
        </index>
    </table>
</schema>
